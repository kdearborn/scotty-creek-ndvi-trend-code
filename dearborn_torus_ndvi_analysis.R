#read in the forest attributes data, forest dynamics data, average peak ndvi values, and ndvi trend values as individual vectors

maxndviavg <- c(0.651886,0.64321,0.651837,0.675923,0.662987,0.662315,0.686161,0.694363,0.680549,0.707838,0.698731,0.696675,0.697075,0.679684,0.656164,0.675461,0.645873,0.633992,0.655065,0.657385,0.653217,0.674956,0.664256,0.646538,0.626188,0.668999,0.677849,0.634482,0.676592,0.673095,0.671029,0.698026,0.687413,0.660909,0.679076,0.663511,0.656841,0.663567,0.65123,0.666027,0.643192,0.665817,0.631799,0.644732,0.668275,0.625023,0.642582,0.654842,0.64018,0.657719,0.662592,0.654968,0.670091,0.6689,0.667693,0.6778,0.672995,0.680758,0.676784,0.661303,0.675335,0.660369,0.651059,0.663602,0.661771,0.65963,0.66235,0.667358,0.664723,0.655699,0.659006,0.67081,0.661651,0.666417,0.67504,0.68154,0.68146,0.683945)
allspp_ba <- c(3.8649099,3.8338301,4.53967,4.9430699,4.5907602,3.03894,0.103777,0.847243,1.44403,1.21347,0.223236,0.366746,0.265237,1.05045,1.3042001,2.79916,4.8196602,6.0297899,5.48206,6.8235998,7.0436201,2.8037701,2.2618001,1.52723,5.9453402,3.7996199,0.586971,7.4833102,3.81586,3.91151,7.8345599,2.7772999,2.9658899,7.7207198,0.881164,0.914622,15.4907999,8.3072205,7.1827002,10.1964998,9.8995199,9.2609301,6.92313,9.9965,9.7493601,11.7449999,9.7722998,6.16219,9.6617298,10.3165998,12.4895,7.9801002,10.7719002,11.1908998,7.5486002,5.50985,6.6403399,2.9156499,5.1669302,10.6426001,2.5286,3.25156,14.1959,4.6844001,3.6803899,4.3190799,16.9948006,6.7377,3.5985999,14.8660002,8.7309799,10.1673002,12.0340004,3.8062201,8.4131098,6.0592799,0.493134,1.59378)
allspp_dens <- c(3266.669922,3944.439941,4966.669922,3366.669922,4900,2566.669922,55.5555992,511.1109924,1044.439941,866.6669922,88.8889008,222.2220001,111.1110001,633.3330078,977.7780151,1988.890015,3822.219971,7488.890137,5188.890137,8022.220215,8088.890137,3488.889893,2333.330078,1822.219971,6666.669922,3233.330078,677.7780151,9100,3366.669922,2177.780029,9288.889648,3566.669922,2166.669922,4433.330078,933.3330078,977.7780151,11555.59961,4244.439941,4944.439941,4677.779785,3955.560059,5333.330078,7833.330078,9100,7111.109863,8244.44043,5277.779785,3022.219971,4322.220215,4477.779785,8977.780273,3411.110107,5055.560059,11055.59961,2433.330078,2111.110107,4955.560059,1544.439941,2677.780029,5288.890137,1088.890015,1644.439941,4411.109863,2666.669922,1666.670044,2688.889893,8377.780273,4555.560059,2388.889893,5100,4677.779785,6744.439941,4600,2544.439941,3277.780029,2544.439941,700,1855.560059)
besp_perc <- c(8.8435402,6.76056,36.2416,1.9802001,13.3787003,6.9264102,20,2.1739099,0,0,0,0,0,0,3.40909,34.0782013,4.3604698,0.74184,0,9.6952896,0.412088,0.636943,5.7142901,1.21951,0.833333,0,8.1967201,0,0,0,0.598086,0,0,7.5187998,0,0,0.192308,0,0.674157,2.3752999,0.561798,1.25,0,0.2442,0,0,0.210526,0,0,0,0,0,0,0,0.456621,0,0,0,0,0,0,0,0.755668,0,0.666667,0.413223,1.19363,50.4878006,18.6047001,8.9324598,59.6198997,34.9258995,31.8841,33.1878014,14.5762997,31.0044003,0,0)
lala_perc <- c(0,0.28169,0,0.660066,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6.3694301,14.2856998,1.82927,2.1666701,0.343643,1.63934,0,14.5214996,8.16327,0.239234,11.5264997,33.846199,12.2806997,82.1428986,71.5908966,6.4423099,24.6072998,13.0337,17.8146992,6.74157,13.3332996,14.3261995,6.8376098,17.3437996,1.75202,6.1052599,36.3970985,3.85604,10.4217997,6.4356399,17.9153004,18.4615002,11.9597998,21.9178009,40,18.3857002,63.3093987,56.8465004,25.8402996,67.3469009,64.8648987,13.6020002,27.0832996,48.6666985,50.4132004,14.191,34.1463013,65.1163025,11.5467997,12.1140003,39.7034988,18.3575001,47.1615982,22.7119007,39.3013,92.0634995,92.2155991)
pima_perc <- c(91.1565018,92.9577026,63.7584,97.3597031,86.6212997,93.0736008,80,97.8261032,100,100,100,100,100,100,96.5908966,65.9217987,95.6395035,99.2582016,100,90.3047028,99.5878983,92.9935989,80,96.9512024,97,99.6564026,90.1639023,100,85.4785995,91.3264999,99.1626968,88.4735031,65.6409988,80.2005005,17.8570995,28.4090996,93.1731033,75.3927002,86.292099,79.8099976,92.6966019,85.4167023,85.6737976,92.9181976,82.0313034,98.2480011,93.6841965,63.6029015,95.3727036,89.5782013,93.4405975,81.433197,80.879097,87.7387009,77.6256027,59.4737015,81.6143036,36.6906013,43.1534996,73.9496002,31.6327,34.4594994,85.1384964,72.9167023,50.6666985,48.7602997,78.3820038,15.3659,16.2791004,50.5447006,27.0783997,25.3707008,44.6860008,19.2140007,62.3728981,28.8209991,7.9365101,7.78443)
ndvitrend_1984to2019 <- c(0.0004232,0.000208,0.0001966,0.000665,0.0005138,0.0000376,0.0015464,0.0010403,0.0009562,0.0011842,0.0008463,0.0010182,0.0006625,0.0005039,0.0009434,0.001225,0.000893,0.0005625,0.0008695,0.0016412,0.0006446,0.0009881,0.0010768,0.0004787,0.0007,0.0011248,0.0008926,0.0003952,0.0019341,0.0007401,0.0011892,0.0030737,0.0016133,0.0011474,0.002404,0.0014676,0.0006308,0.0006714,0.00076,0.0010723,0.0000143,0.0011817,0.0009956,0.0010412,0.0013076,0.0010598,0.0011639,0.0010125,0.0012789,0.0012167,0.0016615,0.0013559,0.002,0.0020249,0.0016654,0.001791,0.0015369,0.0012378,0.0009526,0.0008203,0.0016353,0.0007127,0.00015,0.0007639,0.0009426,0.0003476,0.00077,0.0001379,-0.0002529,0.0001901,0.0001832,0.0005178,0.0001105,0.001097,0.0003289,0.001085,0.001601,0.00169)
ndvitrend_2009to2019 <- c(-0.0006161,0.0008252,0.0016286,-0.0039943,-0.0000462,-0.0006394,-0.0044716,-0.0027148,-0.0038164,-0.003771,-0.001722,-0.0014859,-0.0025146,-0.0025264,0.0008011,0.0034566,0.0016731,-0.0014824,0.003212,0.0001176,0.0020056,-0.0043356,-0.0012211,-0.002836,0.0020783,-0.0020283,-0.002192,-0.0031378,0.0002044,0.0008396,0.0024465,0.0029866,0.0033499,0.0034139,0.0005179,0.001972,-0.0000652,-0.0006216,0.0011531,-0.0012853,0.0038704,0.0011515,0.0030947,0.00295,-0.0049917,0.0004061,0.003808,0.0048934,-0.0002573,0.0010348,0.0005158,-0.0015536,-0.002029,-0.0034639,0.0000655,-0.002388,-0.0028585,0.0006894,-0.0001202,0.002115,0.0009778,0.0020568,0.0034242,0.0025371,-0.0004285,-0.0006543,0.0056395,0.0029758,0.001103,-0.0004363,0.0021488,-0.0025816,-0.0041334,-0.008042,0.0006103,0.0025883,-0.0048761,-0.0046105)
all_deaths <- c(52,51,111,55,64,36,18,20,32,18,1,15,26,34,22,51,38,46,106,107,90,41,36,48,43,40,22,33,17,9,61,20,4,28,2,10,72,21,20,39,31,28,26,47,32,18,17,8,16,14,23,6,10,14,5,1,6,1,1,30,3,16,58,10,3,17,60,68,37,90,97,67,81,22,68,67,1,3)
all_recruits <- c(14,17,65,6,49,11,2,1,3,7,0,0,1,5,8,46,24,18,6,50,14,6,18,6,16,5,3,13,12,7,20,7,8,24,7,3,31,21,14,31,17,17,69,29,20,24,10,36,10,19,21,16,20,41,11,12,14,36,10,22,7,4,13,12,7,24,21,59,41,35,65,74,50,48,28,19,8,28)
besp_deaths <- c(17,15,82,5,15,10,8,3,2,2,0,0,1,4,2,24,6,2,2,22,1,1,2,1,0,3,2,0,1,0,1,0,0,3,0,0,0,0,3,2,0,3,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,61,18,7,76,40,40,15,7,41,0,0)
besp_recruits <- c(8,5,52,2,34,5,0,0,0,0,0,0,0,0,0,39,8,2,0,36,2,1,11,0,3,0,2,0,0,0,2,0,0,11,0,0,1,0,0,5,2,2,0,2,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,2,0,0,1,1,36,23,5,54,54,25,24,11,12,0,0)
lala_deaths <- c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,1,1,0,0,1,1,1,1,0,2,1,0,2,0,0,1,0,0,0,0,0,0,0,0,0,0,0,2,1,1,3,0,1,2,1,0,4,4,7,15,2,3,15,4,0,6,6,1,2)
lala_recruits <- c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,2,2,1,0,0,5,2,0,4,6,2,7,3,11,12,5,18,4,4,47,8,8,2,5,28,1,7,3,10,9,9,3,9,6,24,7,14,3,3,1,9,3,15,4,11,9,0,1,6,10,20,6,2,8,28)
pima_deaths <- c(35,36,29,50,49,26,10,17,30,16,1,15,25,30,20,27,32,44,103,85,89,40,32,47,43,37,20,33,16,8,58,19,4,23,1,9,67,21,15,35,30,23,26,44,28,18,17,7,15,13,23,3,7,12,4,0,4,0,0,22,0,11,49,7,2,10,35,0,3,8,13,12,15,6,54,10,0,1)
pima_recruits <- c(6,12,13,4,15,6,2,1,3,7,0,0,1,5,8,7,16,16,6,14,12,2,3,4,11,4,1,13,7,5,18,3,2,11,0,0,19,9,9,8,11,11,22,19,10,22,5,8,8,12,18,5,9,30,7,2,8,12,3,8,3,0,10,3,4,8,13,12,9,13,10,14,13,4,11,5,0,0)

#combine the forest attributes and forest dynamics data into matrices

forest_attributes <- rbind(allspp_ba, allspp_dens, besp_perc, lala_perc, pima_perc)
row.names(forest_attributes)<-c("allspp_ba","allspp_dens","besp_perc", "lala_perc", "pima_perc")
forest_dynamics <- rbind(all_deaths, besp_deaths, lala_deaths, pima_deaths, all_recruits, besp_recruits, lala_recruits, pima_recruits)
row.names(forest_dynamics)<-c("all_deaths","besp_deaths","lala_deaths", "pima_deaths", "all_recruits", "besp_recruits", "lala_recruits", "pima_recruits")

#calculate observed (adjusted) mean, sd, and mode of max_ndvi and ndvi_trend using the dens.multi function (note that this function is not part of a freely available package and was generously provided by Alexandre de Oliveira)

observed_maxndviavg <- dens.multi(niche = maxndviavg, tree.abund = forest_attributes)
observed_ndvitrend_1984to2019 <- dens.multi(niche = ndvitrend_1984to2019, tree.abund = forest_dynamics)
observed_ndvitrend_2009to2019 <- dens.multi(niche = ndvitrend_2009to2019, tree.abund = forest_dynamics)

#calculate torus mean, sd, and mode of max_ndvi and ndvi_trend using the torus.dens function (note that this function is not part of a freely available package and was generously provided by Alexandre de Oliveira)

torus_maxndviavg <- torus.dens(niche=maxndviavg, tree=forest_attributes, plotdim=c(780,90), gridsize=30)
torus_ndvitrend_1984to2019 <- torus.dens(niche=ndvitrend_1984to2019, tree=forest_dynamics, plotdim=c(780,90), gridsize=30)
torus_ndvitrend_2009to2019 <- torus.dens(niche=ndvitrend_2009to2019, tree=forest_dynamics, plotdim=c(780,90), gridsize=30)

#export the torus and observed results as csvs

write.csv(torus_maxndviavg, file = "C:/Users/ToughBook/Documents/Katherine/Landsat/r_analysis/torus/Cont_Torus/ndvi_output/torus_maxndviavg.csv")
write.csv(torus_ndvitrend_1984to2019, file = "C:/Users/ToughBook/Documents/Katherine/Landsat/r_analysis/torus/Cont_Torus/ndvi_output/torus_ndvitrend_1984to2019.csv")
write.csv(torus_ndvitrend_2009to2019, file = "C:/Users/ToughBook/Documents/Katherine/Landsat/r_analysis/torus/Cont_Torus/ndvi_output/torus_ndvitrend_2009to2019.csv")
write.csv(observed_maxndviavg, file = "C:/Users/ToughBook/Documents/Katherine/Landsat/r_analysis/torus/Cont_Torus/ndvi_output/observed_maxndviavg.csv")
write.csv(observed_ndvitrend_1984to2019, file = "C:/Users/ToughBook/Documents/Katherine/Landsat/r_analysis/torus/Cont_Torus/ndvi_output/observed_ndvitrend_1984to2019.csv")
write.csv(observed_ndvitrend_2009to2019, file = "C:/Users/ToughBook/Documents/Katherine/Landsat/r_analysis/torus/Cont_Torus/ndvi_output/observed_ndvitrend_2009to2019.csv")